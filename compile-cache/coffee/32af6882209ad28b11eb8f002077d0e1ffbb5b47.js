(function() {
  var DO, DOEND, END, FN, Point, Range, decorations, highlightRange, _ref;

  DO = "do";

  END = "end";

  FN = "fn";

  DOEND = /(do|end|fn)/g;

  _ref = require("atom"), Range = _ref.Range, Point = _ref.Point;

  decorations = [];

  highlightRange = function(editor, r) {
    var marker;
    marker = editor.markBufferRange(r);
    return decorations.push(editor.decorateMarker(marker, {
      type: 'highlight',
      "class": 'selection'
    }));
  };

  module.exports.handleMatch = function(editor, e) {
    var counter, fromBeginning, lastLineNo, toEnd, word, x, y, _ref1;
    decorations.map(function(a) {
      return a.destroy();
    });
    lastLineNo = editor.buffer.lines.length - 1;
    _ref1 = e.cursor.getBufferPosition().toArray(), x = _ref1[0], y = _ref1[1];
    fromBeginning = new Range([0, 0], [x, y - 1]);
    toEnd = new Range([x, y + 1], [lastLineNo, 0]);
    highlightRange(editor, e.cursor.getCurrentWordBufferRange());
    word = editor.getWordUnderCursor();
    counter = 0;
    if (word === DO) {
      editor.scanInBufferRange(DOEND, toEnd, function(_arg) {
        var m, r, stop;
        r = _arg.range, m = _arg.matchText, stop = _arg.stop;
        if (m === DO || m === FN) {
          counter++;
        }
        if (m === END && counter) {
          return counter--;
        } else if (!counter) {
          highlightRange(editor, r);
          return stop();
        }
      });
    }
    if (word === END) {
      return editor.backwardsScanInBufferRange(DOEND, fromBeginning, function(_arg) {
        var m, r, stop;
        r = _arg.range, m = _arg.matchText, stop = _arg.stop;
        if (m === END) {
          counter++;
        }
        if ((m === DO || m === FN) && counter) {
          return counter--;
        } else if (!counter) {
          highlightRange(editor, r);
          return stop();
        }
      });
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICIiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbCiAgICAiL2hvbWUvaXJhYXN0YS8uYXRvbS9wYWNrYWdlcy9hdXRvY29tcGxldGUtZWxpeGlyL2xpYi9hbGNoZW1pZGUvZG9lbmRtYXRjaGVyLmNvZmZlZSIKICBdLAogICJuYW1lcyI6IFtdLAogICJtYXBwaW5ncyI6ICJBQUFBO0FBQUEsTUFBQSxtRUFBQTs7QUFBQSxFQUFBLEVBQUEsR0FBSyxJQUFMLENBQUE7O0FBQUEsRUFDQSxHQUFBLEdBQU0sS0FETixDQUFBOztBQUFBLEVBRUEsRUFBQSxHQUFLLElBRkwsQ0FBQTs7QUFBQSxFQUdBLEtBQUEsR0FBUSxjQUhSLENBQUE7O0FBQUEsRUFJQSxPQUFpQixPQUFBLENBQVEsTUFBUixDQUFqQixFQUFDLGFBQUEsS0FBRCxFQUFRLGFBQUEsS0FKUixDQUFBOztBQUFBLEVBS0EsV0FBQSxHQUFjLEVBTGQsQ0FBQTs7QUFBQSxFQVFBLGNBQUEsR0FBaUIsU0FBQyxNQUFELEVBQVMsQ0FBVCxHQUFBO0FBQ2YsUUFBQSxNQUFBO0FBQUEsSUFBQSxNQUFBLEdBQVMsTUFBTSxDQUFDLGVBQVAsQ0FBdUIsQ0FBdkIsQ0FBVCxDQUFBO1dBQ0EsV0FBVyxDQUFDLElBQVosQ0FBaUIsTUFBTSxDQUFDLGNBQVAsQ0FBc0IsTUFBdEIsRUFBOEI7QUFBQSxNQUFDLElBQUEsRUFBTSxXQUFQO0FBQUEsTUFBb0IsT0FBQSxFQUFPLFdBQTNCO0tBQTlCLENBQWpCLEVBRmU7RUFBQSxDQVJqQixDQUFBOztBQUFBLEVBWUEsTUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFmLEdBQTZCLFNBQUMsTUFBRCxFQUFTLENBQVQsR0FBQTtBQUMzQixRQUFBLDREQUFBO0FBQUEsSUFBQSxXQUFXLENBQUMsR0FBWixDQUFnQixTQUFDLENBQUQsR0FBQTthQUFPLENBQUMsQ0FBQyxPQUFGLENBQUEsRUFBUDtJQUFBLENBQWhCLENBQUEsQ0FBQTtBQUFBLElBRUEsVUFBQSxHQUFhLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQXBCLEdBQTZCLENBRjFDLENBQUE7QUFBQSxJQUdBLFFBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxpQkFBVCxDQUFBLENBQTRCLENBQUMsT0FBN0IsQ0FBQSxDQUFULEVBQUMsWUFBRCxFQUFJLFlBSEosQ0FBQTtBQUFBLElBSUEsYUFBQSxHQUFvQixJQUFBLEtBQUEsQ0FBTSxDQUFDLENBQUQsRUFBRyxDQUFILENBQU4sRUFBYSxDQUFDLENBQUQsRUFBSSxDQUFBLEdBQUUsQ0FBTixDQUFiLENBSnBCLENBQUE7QUFBQSxJQUtBLEtBQUEsR0FBb0IsSUFBQSxLQUFBLENBQU0sQ0FBQyxDQUFELEVBQUksQ0FBQSxHQUFFLENBQU4sQ0FBTixFQUFnQixDQUFDLFVBQUQsRUFBYSxDQUFiLENBQWhCLENBTHBCLENBQUE7QUFBQSxJQU1BLGNBQUEsQ0FBZSxNQUFmLEVBQXVCLENBQUMsQ0FBQyxNQUFNLENBQUMseUJBQVQsQ0FBQSxDQUF2QixDQU5BLENBQUE7QUFBQSxJQVFBLElBQUEsR0FBTyxNQUFNLENBQUMsa0JBQVAsQ0FBQSxDQVJQLENBQUE7QUFBQSxJQVNBLE9BQUEsR0FBVSxDQVRWLENBQUE7QUFVQSxJQUFBLElBQUcsSUFBQSxLQUFRLEVBQVg7QUFDRSxNQUFBLE1BQU0sQ0FBQyxpQkFBUCxDQUF5QixLQUF6QixFQUFnQyxLQUFoQyxFQUF1QyxTQUFDLElBQUQsR0FBQTtBQUNyQyxZQUFBLFVBQUE7QUFBQSxRQUQ4QyxTQUFQLE9BQXFCLFNBQVgsV0FBYyxZQUFBLElBQy9ELENBQUE7QUFBQSxRQUFBLElBQUcsQ0FBQSxLQUFLLEVBQUwsSUFBVyxDQUFBLEtBQUssRUFBbkI7QUFBMkIsVUFBQSxPQUFBLEVBQUEsQ0FBM0I7U0FBQTtBQUNBLFFBQUEsSUFBRyxDQUFBLEtBQUssR0FBTCxJQUFhLE9BQWhCO2lCQUE2QixPQUFBLEdBQTdCO1NBQUEsTUFDSyxJQUFHLENBQUEsT0FBSDtBQUNILFVBQUEsY0FBQSxDQUFlLE1BQWYsRUFBdUIsQ0FBdkIsQ0FBQSxDQUFBO2lCQUNBLElBQUEsQ0FBQSxFQUZHO1NBSGdDO01BQUEsQ0FBdkMsQ0FBQSxDQURGO0tBVkE7QUFpQkEsSUFBQSxJQUFHLElBQUEsS0FBUSxHQUFYO2FBQ0UsTUFBTSxDQUFDLDBCQUFQLENBQWtDLEtBQWxDLEVBQXlDLGFBQXpDLEVBQXdELFNBQUMsSUFBRCxHQUFBO0FBQ3RELFlBQUEsVUFBQTtBQUFBLFFBRCtELFNBQVAsT0FBcUIsU0FBWCxXQUFjLFlBQUEsSUFDaEYsQ0FBQTtBQUFBLFFBQUEsSUFBRyxDQUFBLEtBQUssR0FBUjtBQUFpQixVQUFBLE9BQUEsRUFBQSxDQUFqQjtTQUFBO0FBQ0EsUUFBQSxJQUFHLENBQUMsQ0FBQSxLQUFLLEVBQUwsSUFBVyxDQUFBLEtBQUssRUFBakIsQ0FBQSxJQUF3QixPQUEzQjtpQkFBd0MsT0FBQSxHQUF4QztTQUFBLE1BQ0ssSUFBRyxDQUFBLE9BQUg7QUFDSCxVQUFBLGNBQUEsQ0FBZSxNQUFmLEVBQXVCLENBQXZCLENBQUEsQ0FBQTtpQkFDQSxJQUFBLENBQUEsRUFGRztTQUhpRDtNQUFBLENBQXhELEVBREY7S0FsQjJCO0VBQUEsQ0FaN0IsQ0FBQTtBQUFBIgp9

//# sourceURL=/home/iraasta/.atom/packages/autocomplete-elixir/lib/alchemide/doendmatcher.coffee
