(function() {
  var Process, autocomplete, fs, inp, out, path, spawn, waitTillEnd;

  autocomplete = "autocompleter/autocomplete.exs";

  Process = require("atom").BufferedProcess;

  spawn = require('child_process').spawn;

  path = require('path');

  fs = require('fs');

  out = null;

  inp = null;

  exports.init = function(projectPaths) {
    var ac, array, exit, p, stderr;
    p = path.join(__dirname, autocomplete);
    array = projectPaths;
    stderr = function(e) {
      return console.log("Err: " + e);
    };
    exit = function(e) {
      console.log("CLOSED " + e);
      return exports.init(projectPaths);
    };
    array.push(p);
    ac = new Process({
      command: "elixir",
      args: array.reverse(),
      stderr: stderr,
      exit: exit
    });
    out = ac.process.stdout;
    return inp = ac.process.stdin;
  };

  exports.getAutocompletion = function(prefix, cb) {
    if (prefix.trim().length < 1) {
      cb();
      return;
    }
    inp.write("a " + prefix + "\n");
    return waitTillEnd(function(chunk) {
      var multi, one, _, _ref;
      _ref = chunk.split("<>"), _ = _ref[0], one = _ref[1], multi = _ref[2];
      return cb({
        one: one,
        multi: multi.split(";").filter(function(a) {
          return a.trim();
        })
      });
    });
  };

  exports.loadFile = function(path, cb) {
    if (cb == null) {
      cb = (function() {});
    }
    if (!/.ex$/.test(path)) {
      cb();
      return;
    }
    inp.write("l " + path + "\n");
    return waitTillEnd(function(chunk) {
      console.log("File load " + path + " -> " + chunk);
      if (cb) {
        return cb(chunk);
      }
    });
  };

  waitTillEnd = function(cb) {
    var chunk, fn;
    chunk = "";
    fn = function(data) {
      chunk += data;
      if (~chunk.indexOf("ok.")) {
        out.removeListener("data", fn);
        return cb(chunk.replace("ok.", ""));
      }
    };
    return out.on("data", fn);
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAiZmlsZSI6ICIiLAogICJzb3VyY2VSb290IjogIiIsCiAgInNvdXJjZXMiOiBbCiAgICAiIgogIF0sCiAgIm5hbWVzIjogW10sCiAgIm1hcHBpbmdzIjogIkFBQUE7QUFBQSxNQUFBLDZEQUFBOztBQUFBLEVBQUEsWUFBQSxHQUFlLGdDQUFmLENBQUE7O0FBQUEsRUFDQSxPQUFBLEdBQVUsT0FBQSxDQUFRLE1BQVIsQ0FBZSxDQUFDLGVBRDFCLENBQUE7O0FBQUEsRUFHQSxLQUFBLEdBQVEsT0FBQSxDQUFRLGVBQVIsQ0FBd0IsQ0FBQyxLQUhqQyxDQUFBOztBQUFBLEVBSUEsSUFBQSxHQUFPLE9BQUEsQ0FBUSxNQUFSLENBSlAsQ0FBQTs7QUFBQSxFQUtBLEVBQUEsR0FBSyxPQUFBLENBQVEsSUFBUixDQUxMLENBQUE7O0FBQUEsRUFPQSxHQUFBLEdBQU0sSUFQTixDQUFBOztBQUFBLEVBUUEsR0FBQSxHQUFPLElBUlAsQ0FBQTs7QUFBQSxFQVVBLE9BQU8sQ0FBQyxJQUFSLEdBQWUsU0FBQyxZQUFELEdBQUE7QUFDYixRQUFBLDBCQUFBO0FBQUEsSUFBQSxDQUFBLEdBQUksSUFBSSxDQUFDLElBQUwsQ0FBVSxTQUFWLEVBQXFCLFlBQXJCLENBQUosQ0FBQTtBQUFBLElBQ0EsS0FBQSxHQUFRLFlBRFIsQ0FBQTtBQUFBLElBRUEsTUFBQSxHQUFTLFNBQUMsQ0FBRCxHQUFBO2FBQU8sT0FBTyxDQUFDLEdBQVIsQ0FBYSxPQUFBLEdBQU8sQ0FBcEIsRUFBUDtJQUFBLENBRlQsQ0FBQTtBQUFBLElBR0EsSUFBQSxHQUFPLFNBQUMsQ0FBRCxHQUFBO0FBQU8sTUFBQSxPQUFPLENBQUMsR0FBUixDQUFhLFNBQUEsR0FBUyxDQUF0QixDQUFBLENBQUE7YUFBNEIsT0FBTyxDQUFDLElBQVIsQ0FBYSxZQUFiLEVBQW5DO0lBQUEsQ0FIUCxDQUFBO0FBQUEsSUFLQSxLQUFLLENBQUMsSUFBTixDQUFXLENBQVgsQ0FMQSxDQUFBO0FBQUEsSUFNQSxFQUFBLEdBQVMsSUFBQSxP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
//# sourceURL=/home/iraasta/.atom/packages/autocomplete-elixir/lib/alchemide/wrapper.coffee